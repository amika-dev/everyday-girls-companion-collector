@using EverydayGirlsCompanionCollector.Constants
@model EverydayGirlsCompanionCollector.Models.ViewModels.DailyAdoptViewModel
@{
    ViewData["Title"] = "Daily Adopt";
}

<div class="daily-adopt-container">
    <h1 class="text-center mb-4">Daily Adopt</h1>

    <!-- Countdown -->
    <div class="countdown-panel text-center mb-4">
        <div class="eg-subtitle" style="margin-bottom: 12px;">Next Reset In</div>
        <p class="countdown-timer">
            <strong data-countdown-seconds="@((int)Model.TimeUntilReset.TotalSeconds)"></strong>
        </p>
        <small class="text-muted">Daily reset at 18:00 UTC</small>
    </div>

    <!-- Messages -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    <!-- Collection Cap Warning -->
    @if (Model.IsCollectionFull)
    {
        <div class="alert alert-warning">
            <strong>Collection limit reached (@GameConstants.MaxCollectionSize).</strong> Abandon someone (not your partner) to adopt new girls.
        </div>
    }

    <!-- Daily Roll Available: Show "Use Daily Roll" button -->
    @if (Model.IsDailyRollAvailable)
    {
        <div class="eg-card eg-card--warm text-center" style="max-width: 500px; margin: 0 auto;">
            <div class="eg-rhythm-sm">
                <div class="eg-subtitle">Daily Roll</div>
                <p class="mb-3">Your daily roll is ready.</p>
                <form method="post" asp-action="UseRoll">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-primary btn-lg">Use Daily Roll</button>
                </form>
            </div>
        </div>
    }
    else
    {
        <!-- Daily Roll Used: Show candidates -->
        @if (Model.Candidates.Any())
        {
            <div class="candidates-section">
                <div class="eg-subtitle text-center mb-2">Today's Candidates</div>
                <p class="text-center text-muted mb-4" style="font-size: 0.95rem; font-style: italic;">Five new faces found their way to you today.</p>
                
                <div class="candidates-grid">
                    @foreach (var girl in Model.Candidates)
                    {
                        <div class="eg-card girl-card">
                            <img src="@girl.ImageUrl" alt="@girl.Name" class="eg-portrait-ring--square girl-image-square" style="width: 150px; height: 150px; object-fit: cover; margin-bottom: 12px;" />

                            <div class="eg-card-name-area">
                                <h5 class="eg-hero-name" style="font-size: 1.2rem;" title="@girl.Name">@girl.Name</h5>
                            </div>
                            
                            <div class="eg-card-action-area">
                                @if (Model.IsCollectionFull)
                                {
                                    <p class="text-muted mb-0" style="font-size: 0.9rem; font-style: italic; text-align: center;">Your home is full right now.</p>
                                }
                                else if (Model.IsDailyAdoptAvailable)
                                {
                                    <form method="post" asp-action="Adopt" onsubmit="return confirmAdopt('@girl.Name');">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="girlId" value="@girl.GirlId" />
                                        <button type="submit" class="btn btn-primary">Adopt</button>
                                    </form>
                                }
                                else
                                {
                                    var isAdoptedGirl = Model.TodayAdoptedGirl != null && girl.GirlId == Model.TodayAdoptedGirl.GirlId;
                                    var buttonText = isAdoptedGirl ? "Adopted" : "Adopt";
                                    <button type="button" class="btn btn-secondary" disabled>@buttonText</button>
                                }
                            </div>
                        </div>
                    }
                </div>
                
                <!-- Consolidated Status Message -->
                @if (!Model.IsDailyAdoptAvailable && Model.TodayAdoptedGirl != null)
                {
                    <div class="eg-status-message">
                        <p>You already welcomed @Model.TodayAdoptedGirl.Name today 💖</p>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="eg-card eg-card--warm text-center" style="max-width: 500px; margin: 0 auto;">
                <div class="eg-subtitle" style="margin-bottom: 12px;">Today's Candidates</div>
                <p class="text-muted mb-0">No candidates available for today.</p>
            </div>
        }
    }

    <!-- Back Button -->
    <div class="text-center mt-4">
        <a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary">Back to Main Menu</a>
    </div>
</div>

