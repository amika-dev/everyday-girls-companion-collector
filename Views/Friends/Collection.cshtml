@model EverydayGirlsCompanionCollector.Models.PagedResult<EverydayGirlsCompanionCollector.Models.ViewModels.FriendGirlListItemDto>
@{
    ViewData["Title"] = "Friend's Collection";
    var friendUserId = ViewData["FriendUserId"] as string;
    var friendDisplayName = ViewData["FriendDisplayName"] as string ?? "Friend";
    var sortMode = ViewData["SortMode"] as string ?? "bond";
}

<div class="collection-container">

    <!-- Viewing Selector -->
    <div class="eg-viewing-selector mb-4">
        <div class="eg-viewing-label">@friendDisplayName's Collection</div>
        <div class="eg-viewing-pills">
            <a href="/Friends/@friendUserId/Collection?sort=bond&page=1"
               class="eg-viewing-pill @(sortMode == "bond" ? "active" : "")">
                Bond
            </a>
            <a href="/Friends/@friendUserId/Collection?sort=oldest&page=1"
               class="eg-viewing-pill @(sortMode == "oldest" ? "active" : "")">
                Oldest
            </a>
            <a href="/Friends/@friendUserId/Collection?sort=newest&page=1"
               class="eg-viewing-pill @(sortMode == "newest" ? "active" : "")">
                Newest
            </a>
        </div>
    </div>

    @if (Model.Items.Count == 0)
    {
        <div class="eg-card eg-card--warm text-center" style="max-width: 500px; margin: 0 auto;">
            <div class="eg-rhythm-sm">
                <div class="eg-subtitle">Companions</div>
                <p class="text-muted mb-0">No companions here yet ‚Äî their journey is just beginning.</p>
            </div>
        </div>
    }
    else
    {
        <div class="collection-grid">
            @foreach (var girl in Model.Items)
            {
                <div class="collection-card girl-card @(girl.IsPartner ? "partner-highlight" : "")">
                    <img src="@girl.ImageUrl" alt="@girl.Name" class="collection-image girl-image-square eg-portrait-ring--square" />

                    <div class="eg-card-name-area">
                        <h5 class="eg-hero-name" style="font-size: 1.1rem; margin: 0;" title="@girl.Name">@girl.Name</h5>
                    </div>

                    <div class="eg-card-badge-area">
                        <span class="eg-badge--partner @(girl.IsPartner ? "" : "eg-badge--ghost")">Partner</span>
                    </div>

                    <div class="eg-card-stats-area">
                        <span class="eg-card-stat">üíñ @girl.Bond</span>
                        <span class="eg-card-stat">@girl.PersonalityTag</span>
                    </div>

                    <div class="eg-card-action-area">
                        <button type="button" class="btn btn-sm btn-info"
                                data-bs-toggle="modal" data-bs-target="#friendGirlModal"
                                onclick="loadFriendGirlModal('@friendUserId', @girl.GirlId)">
                            More About Her
                        </button>
                    </div>
                </div>
            }
        </div>

        <!-- Gallery Navigation -->
        <div class="eg-gallery-nav">
            @if (Model.HasPrevious)
            {
                <a href="/Friends/@friendUserId/Collection?sort=@sortMode&page=@(Model.Page - 1)" class="eg-nav-button eg-nav-prev">
                    <span class="eg-nav-icon">‚Üê</span>
                    <span class="eg-nav-label">Earlier Companions</span>
                </a>
            }
            else
            {
                <div class="eg-nav-button eg-nav-disabled">
                    <span class="eg-nav-icon">‚Üê</span>
                    <span class="eg-nav-label">Earlier Companions</span>
                </div>
            }

            @if (Model.HasNext)
            {
                <a href="/Friends/@friendUserId/Collection?sort=@sortMode&page=@(Model.Page + 1)" class="eg-nav-button eg-nav-next">
                    <span class="eg-nav-label">More Companions</span>
                    <span class="eg-nav-icon">‚Üí</span>
                </a>
            }
            else
            {
                <div class="eg-nav-button eg-nav-disabled">
                    <span class="eg-nav-label">More Companions</span>
                    <span class="eg-nav-icon">‚Üí</span>
                </div>
            }
        </div>
    }

    <!-- Back Buttons -->
    <div class="text-center mt-4">
        <a href="/Friends/@friendUserId/Profile" class="btn btn-outline-secondary me-2">Back to Profile</a>
        <a asp-controller="Friends" asp-action="Index" class="btn btn-outline-secondary">Back to Friends</a>
    </div>
</div>

<!-- Friend Girl Modal (content loaded dynamically) -->
<div class="modal fade" id="friendGirlModal" tabindex="-1" aria-labelledby="friendGirlModalLabel" aria-hidden="true">
    <div id="friendGirlModalContent">
        <div class="modal-dialog">
            <div class="modal-content eg-card--warm text-center" style="padding: 40px;">
                <span class="text-muted">Loading‚Ä¶</span>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    function loadFriendGirlModal(friendUserId, girlId) {
        var container = document.getElementById('friendGirlModalContent');
        container.innerHTML = '<div class="modal-dialog"><div class="modal-content eg-card--warm text-center" style="padding: 40px;"><span class="text-muted">Loading\u2026</span></div></div>';
        fetch('/Friends/' + friendUserId + '/GirlDetails/' + girlId)
            .then(function (response) {
                if (!response.ok) throw new Error('Not found');
                return response.text();
            })
            .then(function (html) {
                container.innerHTML = html;
            })
            .catch(function () {
                container.innerHTML = '<div class="modal-dialog"><div class="modal-content eg-card--warm text-center" style="padding: 40px;"><span class="text-muted">Could not load details.</span></div></div>';
            });
    }
</script>
}
